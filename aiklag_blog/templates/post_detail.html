{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block head_title %}{{ instance.title }} | {{ block.super}}{% endblock head_title %}

{% block post_detail_link %}
<li><a href='{{ instance.get_absolute_url }}'>{{ instance.title }}</a></li>
{% endblock post_detail_link %}
{% block content %}



<div class="col-sm-8 col-sm-offset-2">
    {% if instance.image %}
        <img class="img-responsive" src="{{ instance.image.url }}" alt="img">
    {% endif %}
    <h1>{{ title }} <small>{{instance.publish}}</small></h1>
    <p>Read time: {{ instance.read_time|time:"i" }} minutes</p>
    <p>Author: {{ instance.user}}</p>
    <hr/>
    <!--<p>-->
        <!--<div class="fb-like" data-href="{{ request.build_absolute_url }}" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="true"></div>-->
    <!--</p>-->
    <div class="col-sm-12 post-detail-item">
        {{instance.get_markdown}}
    </div>
    <div>
        <p class="lead">Comments</p>
        {% if request.user.is_authenticated %}
        <form method="POST" action="."> {% csrf_token %}
            {{ comment_form|crispy }}
            <input type="submit" value="Post comment" class="btn btn-default">
        </form>
        {% else %}
        <p>You mast login to comment</p>
        {% endif %}
        <hr>
        {% for comment in comments %}
        <blockquote>
            <p>{{comment.content}}</p>
            <footer>via {{comment.user}} | {{ comment.timestamp|timesince}} ago | {% if comment.children.count > 0 %}
                {{ comment.children.count }} Comment{% if comment.children.count > 1 %}s {% endif %} | {% endif %}
                <a class="comment-reply-btn" href="#">Reply</a> | <a href="{{ comment.get_absolute_url }}">Thread</a>
            </footer>
            <div class="comment-reply">
                {% for child_comment in comment.children %}
                    <blockquote>
                        <p>{{child_comment.content}}</p>
                        <footer>via {{child_comment.user}} | {{  child_comment.timestamp|timesince}} ago</footer>
                    </blockquote>
                {% endfor %}
                {% if request.user.is_authenticated %}
                <form method="POST" action="."> {% csrf_token %}
                    {{ comment_form|crispy }}
                    <input type="hidden" name="parent_id" value="{{ comment.id }}">
                    <input type="submit" value="Reply" class="btn btn-default">
                </form>
                {% else %}
                    <p>You mast login to comment</p>
                {% endif %}
            </div>
        </blockquote>
        {% endfor %}
    </div>
    <!--<div class="fb-comments" data-href="{{ request.build_absolute_url }}" data-numposts="5"></div>-->
</div>

{% endblock content %}

